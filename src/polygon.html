<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index, all" />
  <title>WebGL Earth API - Polygon Example</title>

  <script src="../cesium/Build/Cesium/Cesium.js"></script>
  <script src="http://localhost:9810/compile?id=api-debug"></script>

  <script>
    var app, poly;
    function startWE() {
      var options = {
        altitude: 360,
        position: [47.192, 8.523],
        proxyHost: 'http://srtm.webglearth.com/cgi-bin/corsproxy.fcgi?url=',
        sky:'Skybox'
      };

      app = new WebGLEarth('webglearthdiv', options);
      app.setBaseMap(app.initMap(WebGLEarth.Maps.OSM));
      app.showMiniGlobe('../deploy/world512.jpg', 128);
      app.setTilt(45);

      var defaultPoly = new WebGLEarth.Polygon(app);
      defaultPoly.setFillColor('#00ffff', 0.3);


      defaultPoly.addPoint(47.1966945, 8.52359601);
      defaultPoly.addPoint(47.1963864, 8.52475703);
      var cornerPoint =
      defaultPoly.addPoint(47.1954063, 8.52230885);
      defaultPoly.addPoint(47.1966242, 8.52120111);
      defaultPoly.addPoint(47.1967805, 8.52164874);
      defaultPoly.addPoint(47.1972796, 8.52242167);
      defaultPoly.addPoint(47.1972434, 8.52277868);
      defaultPoly.disableClickToAdd();
      defaultPoly.showDraggers(false);
      defaultPoly.onClick(reopenPoly);



      // Dadadadadadadadada
      var route=[[121.352647, 31.551947], [121.51547, 31.444865], [121.748397, 31.312112], [121.8900865, 31.1402767],
[122.0590013, 30.9160981], [122.108088, 30.824376], [122.1091264, 30.7722529], [122.00394, 30.652751], [121.903237,
30.537748], [121.8839067, 30.3809013], [121.8818468, 30.2451575], [121.882927, 30.117808], [121.894893, 30.0860574],
[121.932063, 30.046931], [122.011274, 29.932514], [122.040612, 29.919312], [122.134568, 29.912492], [122.156495,
29.889975], [121.992205, 29.735953], [122.034745, 29.697814], [122.068369, 29.650488], [122.134492, 29.50712],
[122.14036, 29.433776], [122.0528215, 28.8648499], [122.0040697, 28.5197139], [121.949919, 28.337054], [121.7060655,
28.0135279], [121.4932054, 27.7841426], [121.436294, 27.726134], [121.3194841, 27.5810545], [121.2048143, 27.4434219],
[121.0461992, 27.2427557], [120.9246629, 27.0881974], [120.8415788, 26.9817764], [120.8182329, 26.9481166],
[120.7042497, 26.8237944], [120.5277818, 26.6379758], [120.4474443, 26.547717], [120.360927, 26.4770568], [120.318355,
26.4370993], [120.2722, 26.406137], [120.2064317,
26.375599], [120.1171678, 26.3460672], [120.058933, 26.329623], [119.985973, 26.320337], [119.834, 26.24091],
[119.759382, 26.141419], [119.827782, 26.114474], [119.877528, 26.083383], [119.9077409, 26.0022088], [119.971599,
25.747672], [120.004413, 25.58534], [119.9963182, 25.4138491], [119.949869, 25.363665], [119.8054308, 25.2164645],
[119.7141069, 25.1269772], [119.5300859, 24.992001], [119.3460649, 24.8350682], [119.2004961, 24.7141191],
[119.0549272, 24.5886818], [118.8839525, 24.4412417], [118.683353, 24.27411], [118.5591692, 24.1452178], [118.3827013,
23.9941249], [118.16458, 23.804587], [117.9672807, 23.6184488], [117.8045457, 23.4717801], [117.5539201, 23.2612496],
[117.4056047, 23.1350239], [117.2305101, 23.021319], [116.9922441, 22.8752572], [116.788997, 22.7505694], [116.5054124,
22.5674458], [116.1950487, 22.3751896], [116.0378069, 22.2799148], [115.6587785, 22.040171], [115.415301, 21.891231],
[115.1946062, 21.6909596], [114.8224443, 21.3575272], [114.4736284, 21.0457655], [112.8827554, 19.5229913],
[111.069538, 17.83583], [109.375755, 15.358068], [109.697437, 13.723394], [109.862898, 12.883078], [109.967501,
12.346476], [109.728463, 11.370943], [106.87898, 8.59221], [106.110062, 5.595404], [104.710239, 2.381724], [104.436354,
1.273817], [103.588909, 4.790147], [103.147402, 5.928224], [101.130271, 7.521192], [100.926672, 8.346897], [100.926672,
9.855032], [100.516459, 11.755283], [100.184198, 13.393744], [101.284296, 11.3739], [103.120998, 10.048125],
[104.911339, 8.460913], [106.6425211, 8.5424083], [106.4447671, 6.276486], [105.3900796, 4.2636521], [104.8847086,
2.4650739], [104.599064, 1.2572378], [103.393256, 1.190123], [103.357566, 0.606032], [103.67339, 0.433222],
[105.073063, -2.29249], [103.5663492, 0.2246233], [103.0609781, 1.279205], [102.5336343, 2.0040003], [100.288944,
3.27706], [98.402775, 4.7674529], [96.8866617, 5.7520467], [96.371538, 5.235763], [95.060544, 6.209842], [89.082223,
7.405921], [85.03773, 7.595586], [83.574177, 7.31192], [82.358191, 6.812564], [81.885547, 6.108714], [80.874045,
5.774265], [80.396845, 5.810973], [80.054239, 6.014905], [79.947065, 6.44279], [78.683128, 6.880306], [77.9022867,
7.5416193], [77.177189, 8.1728407], [76.385092, 8.729345], [75.941902, 9.963503], [75.762675, 11.246887]]

      var defaultPoly2 = new WebGLEarth.Polygon(app);
      defaultPoly2.setFillColor('#000000', 0.0);
      route.forEach(coor => defaultPoly2.buildRoute(coor[1],coor[0]))
      defaultPoly2.disableClickToAdd();
      // defaultPoly2.buildRoute(123);
      defaultPoly2.showDraggers(false);
      defaultPoly2.onClick(reopenPoly);

      // let the corner point animate in circle
      //   not very useful way of demonstrating the movePoint() method
      setInterval(function() {
        var alpha = 2 * Math.PI * (+new Date())/1000;
        var x_ = Math.cos(alpha)/8000;
        var y_ = Math.sin(alpha)/8000;
        defaultPoly.movePoint(cornerPoint, 47.1954063 + x_, 8.52230885 + y_);
        document.getElementById('info3div').innerHTML = "The two default polygons " + (defaultPoly.intersects(defaultPoly2) ? "DO" : "DO NOT") + " intersect.";
      }, 50);
    }

    function reopenPoly(pol_) {
      if (poly) {
        // disable old active polygon
        poly.disableClickToAdd();
        poly.showDraggers(false);
      }
      poly = pol_;
      poly.showDraggers(true);
      poly.setOnChange(onchange);
    }

    function startPoly() {
      if (poly) {
        closePoly();
      }
      poly = new WebGLEarth.Polygon(app);
      poly.enableClickToAdd();
      poly.setOnChange(onchange);
      setBorder('#000000', 0.9);
      poly.setFillColor('#eedd00', 0.6);
      poly.onClick(reopenPoly);
      document.getElementById('infodiv').innerHTML = 'Create polygon by clicking on the ground, Alt-click on polygon node to remove it.';
    }

    function closePoly() {
      if (!poly) return;
      poly.disableClickToAdd();
      poly.showDraggers(false);
      poly = null;
      document.getElementById('infodiv').innerHTML = '';
      document.getElementById('info2div').innerHTML = '';
    }

    function removePoly() {
      if (!poly) return;
      poly.destroy();
      poly = null;
    }

    var borderHex = '#000000', borderAlpha = 1; //remember the color so we can visualize invalid polygons
    function onchange() {
      if (poly) {
        document.getElementById('info2div').innerHTML =
            poly.isValid() ? poly.getRoughArea().toFixed(2) + ' m2' :
            'Invalid polygon (self-intersecting or  < 3 vertices)';
        if (poly.isValid()) {
          poly.setStrokeColor(borderHex, borderAlpha);
        } else {
          poly.setStrokeColor('#ff0000', 1);
        }

        // when the user has already defined already at least 4 points,
        //   disable the "click-to-add" feature
        if (poly.getPoints().length >= 4) {
          poly.disableClickToAdd();
        } else {
          poly.enableClickToAdd();
        }
      }
    }

    function setBorder(hex, opt_a) {
      if (poly) {
        borderHex = hex;
        borderAlpha = opt_a;
        poly.setStrokeColor(hex, opt_a);
      }
    }

    function randomIcon() {
      if (poly) {
        poly.setIcon('../deploy/world512.jpg', 50, 30);
      }
    }
  </script>

</head>

<body onload="javascript:startWE()">
  <div id="webglearthdiv" style="width:600px;height:400px;"></div>
  <div id="infodiv" style="width:600px;height:20px;"></div>
  <div id="info2div" style="width:600px;height:20px;"></div>
  <div id="info3div" style="width:600px;height:20px;"></div>
  <br />
  <input type="button" id="start" value="Start new polygon" onclick="javascript:startPoly()" />
  <input type="button" id="close" value="Close polygon" onclick="javascript:closePoly()" />
  <input type="button" value="Remove polygon" onclick="javascript:removePoly()" />
  <br />
  <input type="button" value="Make green" onclick="javascript:if(poly)poly.setFillColor('#00aa00', 0.7);" />
  <input type="button" value="Make blue" onclick="javascript:if(poly)poly.setFillColor('#0000ff', 0.4);" />
  <input type="button" value="Yellow border" onclick="javascript:setBorder('#ffff00');" />
  <input type="button" value="Black border" onclick="javascript:setBorder('#000000', 0.8);" />
  <br />
  Change fill color:
  <select onchange="javascript:if(poly)poly.setFillColor(this.value, 0.7);">
    <option value="#7bfffb">#7bfffb</option>
    <option value="#f8ff7d">#f8ff7d</option>
    <option value="#5aff5a">#5aff5a</option>
    <option value="#fc7361">#fc7361</option>
    <option value="#ee84fc">#ee84fc</option>
    <option value="#bab3b8">#bab3b8</option>
  </select>
  Change border color:
  <select onchange="javascript:setBorder(this.value);">
    <option value="#7ad3ff">#7ad3ff</option>
    <option value="#ffdb74">#ffdb74</option>
    <option value="#fc2009">#fc2009</option>
    <option value="#fc7361">#fc7361</option>
    <option value="#f225fc">#f225fc</option>
    <option value="#7b7679">#7b7679</option>
  </select>
  <br />
  <input type="button" value="Assign icon" onclick="javascript:randomIcon();" />
  <input type="button" value="Remove icon" onclick="javascript:if(poly)poly.setIcon('');" />
  <br />
  <input type="button" value="Force pause rendering" onclick="javascript:app.pauseRendering();" />
  <input type="button" value="Resume rendering" onclick="javascript:app.resumeRendering();" />
  <br />
  <input type="button" value="Download as PNG" onclick="javascript:app.saveScreenshot('screenshot.png')" />
  <input type="button" value="Open in popup (may get blocked)" onclick="javascript:app.getScreenshot(function(url) {window.open(url, '_blank');});" />
  <input type="button" value="Display screenshot below" onclick="javascript:app.getScreenshot(function(url) {document.getElementById('screenshot').src = url;});" />
  <br />
  <img id="screenshot" />
</body>

</html>